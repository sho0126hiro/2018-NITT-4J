/***  os1-kadai5  ***/

1．課題
	　排他制御すべき共有資源が複数ある場合，「デッドロック」と呼ばれる現象が発生する可能性がある．
	デッドロックとはどのような現象か文章で説明し，それを回避するアイディアを１つ調べて説明せよ．
	　また，共有資源の排他制御を行った場合に「優先度の逆転」という現象にも注意が必要である．
	　優先度の逆転現象について説明せよ．
	
2．デッドロックとは
	デッドロックは，複数のスレッドがお互いの作業を終わるのを待っていて，すべての身動きが取れなくなっている状態のことをいう．
	具体的に，二つのタスクの例を上げる．
		タスクA：変数bを必要とする．
		タスクB：変数aを必要とする．
	　この時，プログラムの途中で，
		タスクAが変数aを占領し，
		タスクBが変数bを占領する．
	　この状態のとき，
		タスクAはタスクBが変数bを開放するまで待つ．
		タスクBはタスクAが変数aを開放するまで待つ．
	　すると，二つのタスクはずっと開放するまで待つため．動作が中断してします．
	
	このような状態をデッドロックという．

3. デッドロックを解消するアイデア
	デッドロックを検出する機構を取り付け，デッドロックを検出すると
	1つの待ちをキャンセルし，もう一度同じ処理を繰り返す．
	
	再試行のタイミングをランダムにさせ，3つ以上の待ちがあるときの，
	再デッドロックを防ぐという方法もある．

4. 優先度の逆転について
	通常は，常に優先度の高いタスクが優先的に実行される．
	しかし，タスク間で共有資源の排他制御をおこなうと，
	優先度の高いタスクが一時的に待ち状態になることによって，タスクの優先度と
	タスクの実行順序が一致しない場合がある．
	例えば，以下の例で優先度が逆転する
	
		条件：タスクはAとBの二つ．優先度の高さはA>B
	
		1．タスクBが実行中にセマフォを獲得
		2．タスクAが実行可能状態に．>>優先度がBより高いので実行
		3．タスクAが実行中にセマフォを獲得 >> セマフォはすでにBに獲得されているため，待ち状態に
		4．タスクAが待ちになったのでタスクBが起動
		
		その後，タスクBでセマフォを開放するまで，タスクAは待ち状態になる．
		この時に，「3」でタスクAを優先して動作させたかった場合，意図した動作に反し，優先度が逆になっている．
		
	一番簡単な解決策は，セマフォ獲得から，開放までにタスク切り替えを行わないことであり，
	タスクを分割したり，優先度の設定を見直す必要がある．
	また，優先度の同じタスクで一つの共有資源を利用するようにするとよい．
	
	その他，「ミューテックス」を使う方法もある．
	これはセマフォと動作が似ているが，
	「優先度継承機能」「優先度上限機能」などの優先度逆転現象を防ぐ機能を備えている．
	ただし，OSによってはミューテックスが使えない（存在しない）場合がある．

