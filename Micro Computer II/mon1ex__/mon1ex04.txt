/***  mon1ex04.txt  ***/

1．課題
	
	: a ff200
	FF200 > mov.b #03:8,r0l
	FF202 > mov.b #00:8,r0h
	FF204 > add.b #10:8,r0h
	FF206 > dec.b r0l
	FF208 > bne ff204:8
	FF20A > mov.b r0h,r1l
	FF20C > nop
	FF20E > .
	: da ff200 ff20c
	<ADDR> <CODE> <MNEMONIC> <OPERAND>
	FF200 F803 MOV.B #H'03:8,R0L
	FF202 F000 MOV.B #H'00:8,R0H
	FF204 8010 ADD.B #H'10:8,R0H
	FF206 1A08 DEC.B R0L
	FF208 46FA BNE FF204:8
	FF20A 0C09 MOV.B R0H,R1L
	FF20C 0000 NOP
	
	上記のプログラムを変更して1から10まで和を求めるプログラムにしなさい。
	
2．使用したプログラム・実行結果
	teratarmのログを以下に示す．

	  H8/3048 Series Advanced Mode Monitor Ver. 3.0A
	 Copyright (C) 2003 Renesas Technology Corp.
	
	/*プログラム入力部*/
	: a ff200
	  FF200   >  mov.b #0a:8,r0l
	  FF202   >  mov.b #00:8,r0h
	  FF204   >  add.b r0l,r0h
	  FF206   >  dec.b r0l
	  FF208   >  bne ff204:8
	  FF20A   >  mov.b r0h,r1l
	  FF20C   >  nop
	  FF20E   >  .
	
	/*逆アセンブルで確認*/
	: da ff200 ff20c
	  <ADDR>  <CODE>                <MNEMONIC> <OPERAND>
	  FF200   F80A                  MOV.B      #H'0A:8,R0L
	  FF202   F000                  MOV.B      #H'00:8,R0H
	  FF204   0880                  ADD.B      R0L,R0H
	  FF206   1A08                  DEC.B      R0L
	  FF208   46FA                  BNE        FF204:8
	  FF20A   0C09                  MOV.B      R0H,R1L
	  FF20C   0000                  NOP      
	
	/*プログラムカウンタの確認*/
	: r
	  PC=000000  CCR=80:I.......  SP=000FFF00
	  ER0=00000000  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00

	/*プログラムカウンタをセット*/
	: .pc
	  PC=000000  ?  ff200
	  CCR=80  ?  .
	
	/*プログラムカウンタの確認*/
	: r
	  PC=0FF200  CCR=80:I.......  SP=000FFF00
	  ER0=00000000  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	
	/*実行*/
	: s
	  PC=0FF202  CCR=80:I.......  SP=000FFF00
	  ER0=0000000A  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF200   F80A                  MOV.B      #H'0A:8,R0L
	: s
	  PC=0FF204  CCR=84:I....Z..  SP=000FFF00
	  ER0=0000000A  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF202   F000                  MOV.B      #H'00:8,R0H
	: s
	  PC=0FF206  CCR=80:I.......  SP=000FFF00
	  ER0=00000A0A  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=80:I.......  SP=000FFF00
	  ER0=00000A09  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF204  CCR=80:I.......  SP=000FFF00
	  ER0=00000A09  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF206  CCR=A0:I.H.....  SP=000FFF00
	  ER0=00001309  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=A0:I.H.....  SP=000FFF00
	  ER0=00001308  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF204  CCR=A0:I.H.....  SP=000FFF00
	  ER0=00001308  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF206  CCR=80:I.......  SP=000FFF00
	  ER0=00001B08  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=80:I.......  SP=000FFF00
	  ER0=00001B07  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF204  CCR=80:I.......  SP=000FFF00
	  ER0=00001B07  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF206  CCR=A0:I.H.....  SP=000FFF00
	  ER0=00002207  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=A0:I.H.....  SP=000FFF00
	  ER0=00002206  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF204  CCR=A0:I.H.....  SP=000FFF00
	  ER0=00002206  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF206  CCR=80:I.......  SP=000FFF00
	  ER0=00002806  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=80:I.......  SP=000FFF00
	  ER0=00002805  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF204  CCR=80:I.......  SP=000FFF00
	  ER0=00002805  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF206  CCR=80:I.......  SP=000FFF00
	  ER0=00002D05  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=80:I.......  SP=000FFF00
	  ER0=00002D04  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF204  CCR=80:I.......  SP=000FFF00
	  ER0=00002D04  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF206  CCR=A0:I.H.....  SP=000FFF00
	  ER0=00003104  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=A0:I.H.....  SP=000FFF00
	  ER0=00003103  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF204  CCR=A0:I.H.....  SP=000FFF00
	  ER0=00003103  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF206  CCR=80:I.......  SP=000FFF00
	  ER0=00003403  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=80:I.......  SP=000FFF00
	  ER0=00003402  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF204  CCR=80:I.......  SP=000FFF00
	  ER0=00003402  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF206  CCR=80:I.......  SP=000FFF00
	  ER0=00003602  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=80:I.......  SP=000FFF00
	  ER0=00003601  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF204  CCR=80:I.......  SP=000FFF00
	  ER0=00003601  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF206  CCR=80:I.......  SP=000FFF00
	  ER0=00003701  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF204   0880                  ADD.B      R0L,R0H
	: s
	  PC=0FF208  CCR=84:I....Z..  SP=000FFF00
	  ER0=00003700  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF206   1A08                  DEC.B      R0L
	: s
	  PC=0FF20A  CCR=84:I....Z..  SP=000FFF00
	  ER0=00003700  ER1=00000000  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF208   46FA                  BNE        FF204:8
	: s
	  PC=0FF20C  CCR=80:I.......  SP=000FFF00
	  ER0=00003700  ER1=00000037  ER2=00000000  ER3=00000000
	  ER4=00000000  ER5=00000000  ER6=00000000  ER7=000FFF00
	  FF20A   0C09                  MOV.B      R0H,R1L
	  
3．考察

	作成したプログラムは以下である。

	  FF200   >  mov.b #0a:8,r0l
	  FF202   >  mov.b #00:8,r0h
	  FF204   >  add.b r0l,r0h
	  FF206   >  dec.b r0l
	  FF208   >  bne ff204:8
	  FF20A   >  mov.b r0h,r1l
	  FF20C   >  nop
	  FF20E   >  .

	これをC言語で書くと下のようになる。

		int x=10;
		int y=0;
		int z;
		do{
			y+=x;
			x--;
		}while(x>0);
		z=y;

	実行画面の最後では、ER0=00003700  ER1=00000037 となっているが
	37(16進）＝ 55(10進)より、正しく動作していると考えられる。

	また、CCR（コンディションコードレジスタ）における各bitごとの役割について
	調べてみた。
		7,6,5,4,3,2,1,0ビットの順で、I,UI,H,U,N,Z,V,Cがある。
		フラグは以下の5つである。
		H：ビット11キャリが発生したときに1がセットされる。
		N：実行結果が負の時1がセットされる。
		Z：実行結果が0の時に1がセットされる。
		V：オーバーフローが発生したときに1がセットされる。
		C：ビット15にキャリが発生したときに1がセットされる。
	
4．まとめ

	条件ジャンプ命令の一つとして、bneがある。
	bneはゼロフラグとよばれるCCR（コンディションコードレジスタ）の
	第2ビットが1になったときに、bnrの直後のアドレスにジャンプする。
	ゼロフラグは、直前の演算結果が0の時に1になる。
	
	bne [アドレス」　：　直前の演算がゼロでなかったらアドレス先にジャンプする。
	
	これを利用することで、C言語でいう、do-while文がかけ、便利である。
	
